<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Furufas Pro</title>
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Furufas">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: Arial,sans-serif; text-align:center; margin:5px; }
  h1 { color:#ff1493; font-size:24px; margin-bottom:5px; }
  #stats { font-size:16px; margin-bottom:5px; }
  .calendar-header { display:flex; justify-content:center; gap:10px; margin-bottom:5px; }
  button { padding:4px 8px; border:none; border-radius:5px; background:#ff69b4; color:white; font-size:12px; }
  .calendar { display:grid; grid-template-columns:repeat(7,1fr); gap:5px; justify-items:center; }
  .day { width:50px; height:50px; line-height:50px; border-radius:50%; border:1px solid #ff69b4;
         cursor:pointer; transition:0.3s; font-size:14px; display:flex; justify-content:center;
         align-items:center; flex-direction:column; position:relative; }
  .day-marked-1 { background:#ffc0cb; color:#ff1493; animation: pulse 1s infinite; }
  .day-marked-2 { background:#ff69b4; color:white; animation: pulse 1s infinite alternate; }
  .day-marked-3 { background:#c71585; color:white; animation: pulse 0.8s infinite alternate; }
  @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
  .note { display:none; font-size:10px; color:#222; margin-top:2px; background:#fff8f0; padding:2px 3px; border-radius:3px; position:absolute; top:-25px; z-index:10; box-shadow:0 1px 3px rgba(0,0,0,0.3); }
  .day.has-note:hover .note, .day.has-note.touch-show .note { display:block; }
  canvas { max-width: 100%; margin-top:10px; }
</style>
</head>
<body>

<h1>Furufas Pro</h1>
<div id="stats"></div>
<div class="calendar-header">
  <button id="prevMonth">&lt;</button>
  <div id="monthYear"></div>
  <button id="nextMonth">&gt;</button>
</div>
<div class="calendar" id="calendar"></div>
<canvas id="chartDays" height="100"></canvas>

<script>
if('serviceWorker' in navigator){navigator.serviceWorker.register('service-worker.js');}

const calendar=document.getElementById('calendar');
const stats=document.getElementById('stats');
const monthYear=document.getElementById('monthYear');
const prevMonthBtn=document.getElementById('prevMonth');
const nextMonthBtn=document.getElementById('nextMonth');
const chartCanvas = document.getElementById('chartDays');

let now=new Date();
let markedDays=JSON.parse(localStorage.getItem('markedDays'))||{};
let chart=null;

function getEmoji(count){
  if(count===1) return 'üçëüí¶';
  else if(count===2) return 'üçëüî•';
  else if(count>=3) return 'üí•üçÜ';
  else return '';
}

function getMonthColor(month){
  const colors=["#fff0f5","#ffe4e1","#ffe4b5","#e6e6fa","#f0fff0","#f5f5dc","#fafad2","#e0ffff","#ffe4e1","#f5f5dc","#e6e6fa","#fff0f5"];
  return colors[month]||"#fff0f5";
}

function renderCalendar(){
  const monthKey=`${now.getFullYear()}-${now.getMonth()}`;
  const daysInMonth=new Date(now.getFullYear(),now.getMonth()+1,0).getDate();
  calendar.innerHTML='';
  monthYear.textContent=now.toLocaleString('pt-BR',{month:'long',year:'numeric'});
  document.body.style.backgroundColor = getMonthColor(now.getMonth());

  if(!markedDays[monthKey]) markedDays[monthKey]={};

  for(let i=1;i<=daysInMonth;i++){
    const day=document.createElement('div');
    day.classList.add('day');
    const count=markedDays[monthKey][i]?.count||0;
    const noteText=markedDays[monthKey][i]?.note||'';

    day.textContent=count>0?`${getEmoji(count)} ${count}`:i;

    if(noteText) {
      day.classList.add('has-note');
      const noteDiv=document.createElement('div');
      noteDiv.classList.add('note');
      noteDiv.textContent=noteText;
      day.appendChild(noteDiv);
    }

    if(count===1) day.classList.add('day-marked-1');
    else if(count===2) day.classList.add('day-marked-2');
    else if(count>=3) day.classList.add('day-marked-3');

    const btn = document.createElement('button');
    btn.textContent = "Apagar";
    btn.style.fontSize="10px";
    btn.style.marginTop="2px";
    btn.addEventListener('click', (e)=>{
      e.stopPropagation();
      markedDays[monthKey][i] = {count:0,note:""};
      localStorage.setItem('markedDays', JSON.stringify(markedDays));
      renderCalendar();
    });
    day.appendChild(btn);

    let timer,longPress=false;
    day.addEventListener('touchstart',()=>{
      longPress=false;
      timer=setTimeout(()=>{
        longPress=true;
        day.classList.add('touch-show');
        const note=prompt(`Nota para dia ${i}:`,noteText);
        if(!markedDays[monthKey][i]) markedDays[monthKey][i]={count:0,note:""};
        markedDays[monthKey][i].note=note||"";
        localStorage.setItem('markedDays',JSON.stringify(markedDays));
        renderCalendar();
      },500);
    });
    day.addEventListener('touchend',(e)=>{
      clearTimeout(timer);
      day.classList.remove('touch-show');
      if(!longPress){
        if(e.detail===2) markedDays[monthKey][i]={count:0,note:""};
        else{
          if(!markedDays[monthKey][i]) markedDays[monthKey][i]={count:0,note:""};
          markedDays[monthKey][i].count+=1;
        }
        localStorage.setItem('markedDays',JSON.stringify(markedDays));
        renderCalendar();
      }
    });

    calendar.appendChild(day);
  }

  // Bot√£o zerar m√™s
  let resetBtn = document.getElementById('resetMonthBtn');
  if(!resetBtn){
    resetBtn = document.createElement('button');
    resetBtn.id = 'resetMonthBtn';
    resetBtn.textContent = "Zerar M√™s";
    resetBtn.style.margin = "5px";
    resetBtn.addEventListener('click', ()=>{
      markedDays[monthKey] = {};
      localStorage.setItem('markedDays', JSON.stringify(markedDays));
      renderCalendar();
    });
    calendar.parentNode.insertBefore(resetBtn, calendar);
  }

  renderStats();
  renderChart(daysInMonth);
}

function renderStats(){
  const monthKey=`${now.getFullYear()}-${now.getMonth()}`;
  const daysMarked=markedDays[monthKey]?Object.values(markedDays[monthKey]).filter(d=>d.count>0).length:0;
  const totalCount=markedDays[monthKey]?Object.values(markedDays[monthKey]).reduce((sum,d)=>sum+(d.count||0),0):0;
  stats.textContent=`Dias marcados: ${daysMarked} | Total de vezes: ${totalCount}`;
}

function renderChart(daysInMonth){
  const monthKey=`${now.getFullYear()}-${now.getMonth()}`;
  const data=[];
  for(let i=1;i<=daysInMonth;i++){
    data.push(markedDays[monthKey][i]?.count||0);
  }
  if(chart) chart.destroy();
  chart = new Chart(chartCanvas, {
    type: 'bar',
    data: {
      labels: Array.from({length:daysInMonth},(_,i)=>i+1),
      datasets: [{label:'Vezes',data:data,backgroundColor:'#ff69b4'}]
    },
    options: {scales:{y:{beginAtZero:true,stepSize:1}}}
  });
}

prevMonthBtn.addEventListener('click',()=>{now.setMonth(now.getMonth()-1);renderCalendar();});
nextMonthBtn.addEventListener('click',()=>{now.setMonth(now.getMonth()+1);renderCalendar();});

renderCalendar();
</script>
</body>
</html>
